#!/bin/sh -ex


apt-get -y update
apt-get -y dist-upgrade
apt-get -y install jellyfin --allow-unauthenticated

# Rename the file server for WebDAVCGI
CONF=/var/www/webdavcgi/webdav.conf
sed -i "s|FILESERVER|MEDIASERVER|" $CONF

# Rename the samba service
CONF=/etc/samba/smb.conf
sed -i "s|FILESERVER|MEDIASERVER|" $CONF
sed -i "s|FileServer|MediaServer|" $CONF

# Replace text in README

# Apache config for WebDavCGI
a2dissite 000-default.conf
a2ensite webdavcgi.conf
a2ensite tkl-webcp.conf

# Apache config for reverse proxy
echo 'Listen 12322' >> /etc/apache2/ports.conf
a2ensite emby-proxy.conf
a2enmod headers
a2enmod proxy_http
a2enmod proxy_wstunnel
